# All variables in this yml are defined in ../.vsts-ci.yml
# RunAsPublic is the only one passed in, because conditional steps can't seem to read global variables
parameters:
  runAsPublic: false

phases:
- template: /eng/build.yml
  parameters:
    name: Windows_NT
    queue:
      name: $(_AgentPool)
      parallel: 99
      matrix:
        Build_Debug:
          _BuildConfig: netcoreapp-Windows_NT-Debug
          _PublishType: none
          _SignType: test
          _DotNetPublishToBlobFeed : false
          runAsPublic: $(_RunAsPublic)
        Build_Release:
          _BuildConfig: netcoreapp-Windows_NT-Release
          _PublishType: $(_PublishType)
          _SignType: $(_SignType)
          _DotNetPublishToBlobFeed : $(_DotNetPublishToBlobFeed)
          runAsPublic: $(_RunAsPublic)

- ${{ if ne(parameters.runAsPublic, 'true') }}:
  - template: /eng/common/templates/phases/publish-build-assets.yml
    parameters:
      dependsOn: Windows_NT
      queue:
        name: Hosted VS2017
      configuration: netcoreapp-Windows_NT-Debug